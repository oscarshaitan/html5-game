<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Defense - Technical Documentation</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Source+Code+Pro:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-pink: #ff00acee;
            --neon-green: #00ff41;
            --neon-yellow: #fcee0a;
            --bg-color: #050510;
            --panel-bg: rgba(5, 5, 16, 0.94);
            --panel-border: rgba(0, 243, 255, 0.62);
            --panel-shadow: 0 0 20px rgba(0, 243, 255, 0.24), inset 0 0 14px rgba(0, 243, 255, 0.08);
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            margin: 0;
            min-height: 100%;
            background:
                radial-gradient(circle at 15% 0%, rgba(0, 243, 255, 0.08), transparent 35%),
                radial-gradient(circle at 90% 15%, rgba(255, 0, 172, 0.08), transparent 40%),
                var(--bg-color);
            color: #cdd7dd;
            font-family: 'Source Code Pro', monospace;
        }

        body {
            max-width: 1120px;
            margin: 0 auto;
            padding: 26px 22px 48px;
            line-height: 1.52;
            border-left: 1px solid rgba(0, 243, 255, 0.25);
            border-right: 1px solid rgba(0, 243, 255, 0.25);
            background-color: rgba(5, 5, 16, 0.72);
        }

        h1,
        h2,
        h3 {
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1.4px;
            margin: 0;
        }

        h1 {
            color: var(--neon-blue);
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            border-bottom: 1px solid rgba(0, 243, 255, 0.5);
            padding-bottom: 14px;
            margin-bottom: 10px;
            text-shadow: 0 0 12px rgba(0, 243, 255, 0.45);
        }

        h2 {
            margin-top: 40px;
            color: var(--neon-pink);
            border-left: 4px solid rgba(255, 0, 172, 0.7);
            padding-left: 12px;
            margin-bottom: 12px;
            text-shadow: 0 0 10px rgba(255, 0, 172, 0.35);
            font-size: clamp(1rem, 2.2vw, 1.26rem);
        }

        h3 {
            color: var(--neon-blue);
            margin-bottom: 8px;
            font-size: 0.94rem;
        }

        p {
            margin: 0 0 10px;
        }

        nav {
            position: sticky;
            top: 10px;
            z-index: 5;
            background: rgba(5, 5, 16, 0.94);
            padding: 10px 12px;
            border: 1px solid var(--panel-border);
            border-radius: 10px;
            margin: 14px 0 28px;
            box-shadow: var(--panel-shadow);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        nav a {
            color: var(--neon-blue);
            text-decoration: none;
            font-weight: 700;
            font-size: 0.8rem;
            padding: 4px 8px;
            border: 1px solid rgba(0, 243, 255, 0.35);
            border-radius: 6px;
            background: rgba(0, 243, 255, 0.06);
        }

        nav a:hover {
            color: #fff;
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.4);
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            margin: 0 0 18px;
            padding: 10px 12px;
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 10px;
            box-shadow: var(--panel-shadow);
        }

        .controls label {
            color: var(--neon-green);
            font-size: 0.78rem;
            font-weight: 700;
            letter-spacing: 0.8px;
        }

        .controls input {
            flex: 1;
            min-width: 220px;
            background: rgba(0, 243, 255, 0.06);
            border: 1px solid rgba(0, 243, 255, 0.35);
            border-radius: 6px;
            padding: 8px 10px;
            color: #d4f7ff;
            font-family: inherit;
            font-size: 0.86rem;
        }

        .controls input:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: 0 0 0 2px rgba(0, 243, 255, 0.2);
        }

        .controls button {
            background: rgba(255, 0, 172, 0.1);
            color: #ffd2ef;
            border: 1px solid rgba(255, 0, 172, 0.5);
            border-radius: 6px;
            padding: 8px 10px;
            font-family: inherit;
            font-size: 0.78rem;
            font-weight: 700;
            cursor: pointer;
        }

        .controls button:hover {
            box-shadow: 0 0 10px rgba(255, 0, 172, 0.35);
        }

        #resultCount {
            color: #8bc9dc;
            font-size: 0.76rem;
            min-width: 122px;
            text-align: right;
        }

        #noResults {
            margin: 8px 0 2px;
            padding: 10px 12px;
            color: #ffd2ef;
            border: 1px solid rgba(255, 0, 172, 0.45);
            background: rgba(255, 0, 172, 0.08);
            border-radius: 8px;
        }

        .method {
            background: var(--panel-bg);
            padding: 14px;
            margin: 12px 0;
            border: 1px solid var(--panel-border);
            border-radius: 10px;
            box-shadow: var(--panel-shadow);
        }

        .method-name {
            color: var(--neon-green);
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .desc {
            margin-top: 8px;
            color: #c6d8de;
        }

        code {
            color: var(--neon-blue);
            background: rgba(0, 243, 255, 0.11);
            padding: 2px 4px;
            border-radius: 4px;
            border: 1px solid rgba(0, 243, 255, 0.22);
            font-size: 0.92em;
        }

        ul {
            margin: 8px 0 0;
            padding-left: 18px;
        }

        li {
            margin-bottom: 6px;
        }

        @media (max-width: 900px) {
            body {
                border-left: none;
                border-right: none;
                padding: 16px 12px 30px;
            }

            nav {
                position: static;
                margin-bottom: 18px;
            }

            .controls {
                margin-bottom: 14px;
            }

            #resultCount {
                text-align: left;
            }

            .method {
                padding: 11px;
            }

            h2 {
                margin-top: 26px;
            }
        }
    </style>
</head>

<body>
    <h1>TECHNICAL REFERENCE</h1>
    <p>Neon Defense Engine Architecture and API Notes</p>

    <nav>
        <a href="#state">STATE</a>
        <a href="#loop">LOOP</a>
        <a href="#waves">WAVES</a>
        <a href="#rifts">RIFTS</a>
        <a href="#combat">COMBAT</a>
        <a href="#ui">UI</a>
        <a href="#audio">AUDIO</a>
        <a href="#debug">DEBUG</a>
    </nav>

    <div class="controls">
        <label for="docSearch">FILTER</label>
        <input id="docSearch" type="search"
            placeholder="Search methods, sections, or keywords (shortcut: /)"
            aria-label="Filter technical documentation">
        <button id="clearSearch" type="button">CLEAR</button>
        <span id="resultCount" aria-live="polite"></span>
    </div>
    <p id="noResults" hidden>No matches found for the current filter.</p>

    <h2 id="state">01. ENGINE STATE & BOOT</h2>
    <div class="method">
        <div class="method-name">window.onload</div>
        <div class="desc">Initializes canvas, binds input, creates initial path, and prepares start-screen state.
            If save data exists, start screen offers <code>loadGame()</code>.</div>
    </div>
    <div class="method">
        <div class="method-name">resetGameLogic()</div>
        <div class="desc">Hard runtime reset for a new run. Reinitializes economy, lives, wave counters, abilities,
            entities, and initial path graph.</div>
    </div>
    <div class="method">
        <div class="method-name">saveGame() / loadGame()</div>
        <div class="desc">Serializes run state to <code>localStorage.neonDefenseSave</code>. Restores towers, rifts,
            economy, and progression metadata. If a saved run was mid-wave, load flow converts it to a short prep phase
            (<code>prepTimer = 5</code>). Audio settings are stored separately via
            <code>localStorage.neonAudioSettings</code>.
        </div>
    </div>
    <div class="method">
        <div class="method-name">startGame() / fullReset()</div>
        <div class="desc">Entry and wipe flows. <code>startGame()</code> launches gameplay, <code>fullReset()</code>
            clears persistent save/tutorial keys and reloads the app.</div>
    </div>

    <h2 id="loop">02. FRAME LOOP</h2>
    <div class="method">
        <div class="method-name">gameLoop(timestamp)</div>
        <div class="desc">Main RAF callback. Runs <code>update()</code> while active and always runs
            <code>draw()</code>.
        </div>
    </div>
    <div class="method">
        <div class="method-name">update()</div>
        <div class="desc">Advances wave timers, cooldowns, enemy/tower/projectile systems, particle simulation, and
            auto-save triggers on key progression events.</div>
    </div>
    <div class="method">
        <div class="method-name">draw()</div>
        <div class="desc">Full canvas redraw under camera transform, including paths, towers, enemies, VFX, and UI
            overlays.</div>
    </div>

    <h2 id="waves">03. WAVE ORCHESTRATION</h2>
    <div class="method">
        <div class="method-name">startPrepPhase()</div>
        <div class="desc">Sets pre-wave timer (30s), clears spawn queue, updates wave UI, and handles scheduled rift
            growth logic.</div>
    </div>
    <div class="method">
        <div class="method-name">startWave()</div>
        <div class="desc">Builds the spawn queue and applies phase effects:
            <ul>
                <li>Base count: <code>5 + floor(wave * 2.5)</code></li>
                <li>Guaranteed boss every 10th wave</li>
                <li>After wave 50: optional surprise boss on non-10th multiples of 5 (25%)</li>
                <li>Every 20th wave: random rift mutation assignment</li>
                <li>After wave 50: each rift has 10% tier-up chance at wave start</li>
            </ul>
        </div>
    </div>
    <div class="method">
        <div class="method-name">spawnEnemy() / spawnSubUnits(parent)</div>
        <div class="desc">Dequeues enemy type, selects a random rift, applies wave scale, rift tier multipliers, and
            mutation modifiers. Splitter death path routes to <code>spawnSubUnits()</code>.</div>
    </div>

    <h2 id="rifts">04. RIFT GENERATION & PATHING</h2>
    <div class="method">
        <div class="method-name">calculatePath()</div>
        <div class="desc">Generates the initial spawn path from a randomized start cell at least 10 grid units from
            center via <code>findPathOnGrid()</code>. Fallback path is applied if generation fails.
        </div>
    </div>
    <div class="method">
        <div class="method-name">generateNewPath()</div>
        <div class="desc">Creates additional rifts using zone-based candidate search and merge behavior:
            <ul>
                <li>Zone ring bounds: inner <code>6 + (zone-1)*3</code>, outer <code>6 + zone*3</code></li>
                <li>Zone capacity: <code>zone 1 => 1</code>, otherwise <code>zone + 1</code></li>
                <li>Direct core-link probability: <code>0.5 / (zone^2)</code></li>
                <li>Global spacing guard: minimum 2.5 grid units</li>
                <li>Merge fallback chooses nearest valid segment with minimum expansion distance of 12 cells</li>
            </ul>
            New path segments can destroy towers occupying newly opened lanes and refund 70% of invested value.
        </div>
    </div>
    <div class="method">
        <div class="method-name">findPathOnGrid(start, end, obstacles)</div>
        <div class="desc">A*-style grid pathfinder with:
            <ul>
                <li>Obstacle crossing penalty: <code>+100</code></li>
                <li>Direction change penalty: <code>+5</code></li>
            </ul>
            Uses Manhattan heuristic and reconstructs center-aligned world points.
        </div>
    </div>

    <h2 id="combat">05. COMBAT & ABILITIES</h2>
    <div class="method">
        <div class="method-name">isValidPlacement(x, y, towerConfig)</div>
        <div class="desc">Validates world-space tower placement against UI exclusion zones, player funds, path
            collisions, and occupied cells.</div>
    </div>
    <div class="method">
        <div class="method-name">buildTower() / upgradeTower() / sellTower()</div>
        <div class="desc">Tower economy and lifecycle entry points. Upgrade scaling and sell-refund logic are applied
            at runtime.</div>
    </div>
    <div class="method">
        <div class="method-name">updateTowers() / shoot() / hitEnemy()</div>
        <div class="desc">Targeting, projectile emission, and damage resolution. Kill handling updates money, total kill
            counters, energy gain, and conditional splitter spawn. Arc towers use instant chain-lightning resolution,
            static charge accumulation, and 0.5s stun trigger at 100 charges.</div>
    </div>
    <div class="method">
        <div class="method-name">activateAbility(type) / useAbility(type, target)</div>
        <div class="desc">Ability state machine for:
            <ul>
                <li><code>emp</code>: AOE freeze + frozen damage vulnerability</li>
                <li><code>overclock</code>: temporary fire-rate buff on a selected tower</li>
            </ul>
            Applies energy costs and cooldown tracking in seconds.
        </div>
    </div>

    <h2 id="ui">06. USER INTERFACE</h2>
    <div class="method">
        <div class="method-name">setupInput() / screenToWorld()</div>
        <div class="desc">Mouse/touch abstraction for panning, zooming, tap-select, and click-build workflows.</div>
    </div>
    <div class="method">
        <div class="method-name">updateUI()</div>
        <div class="desc">Synchronizes HUD counters, wave timers, enemy composition badges, energy bar, and cooldown
            states.</div>
    </div>
    <div class="method">
        <div class="method-name">updateSelectionUI()</div>
        <div class="desc">Renders context panels for selected tower, core, or rift intel (tier and mutation modifiers).
        </div>
    </div>
    <div class="method">
        <div class="method-name">updateWavePanel()</div>
        <div class="desc">Builds wave-intel content from current rift graph and incoming wave metadata. Core fields
            (count/anomaly/threat) always update; extended special-list output requires a matching panel target id in
            the DOM.</div>
    </div>
    <div class="method">
        <div class="method-name">getRepairCost()</div>
        <div class="desc">Dynamic repair-price helper used by core panel controls.</div>
    </div>

    <h2 id="audio">07. AUDIO ENGINE</h2>
    <div class="method">
        <div class="method-name">AudioEngine.init()</div>
        <div class="desc">Creates Web Audio graph (master/music/sfx gains) and resumes suspended contexts on demand.
        </div>
    </div>
    <div class="method">
        <div class="method-name">AudioEngine.updateMusic()</div>
        <div class="desc">16-step sequencer with 15 normal melody variants and one threat profile. Automatically switches
            based on active boss/mutant presence and wave index.</div>
    </div>
    <div class="method">
        <div class="method-name">AudioEngine.setVolume() / toggleMute()</div>
        <div class="desc">Applies gain changes and persists music/SFX/mute settings to local storage.</div>
    </div>
    <div class="method">
        <div class="method-name">AudioEngine.playSFX(type)</div>
        <div class="desc">Procedural synth SFX helper used by tower fire, explosions, hits, and system feedback events.
        </div>
    </div>

    <h2 id="debug">08. DEBUG & OPERATOR HOOKS</h2>
    <div class="method">
        <div class="method-name">unlockDebug()</div>
        <div class="desc">SHA-256 password gate for command center visibility.</div>
    </div>
    <div class="method">
        <div class="method-name">addDebugMoney() / debugSpawn(type)</div>
        <div class="desc">Economy and enemy-injection tooling for stress testing.</div>
    </div>
    <div class="method">
        <div class="method-name">debugCreateRift() / debugLevelUpRift()</div>
        <div class="desc">Rift topology mutation tools for path and scaling validation.</div>
    </div>
    <div class="method">
        <div class="method-name">toggleNoBuildOverlay()</div>
        <div class="desc">Visual debug overlay for placement restrictions and map zoning.</div>
    </div>

    <p style="text-align: center; margin-top: 80px; color: #6a7c85;">NEON DEFENSE ENGINE INTERNAL REFERENCE</p>

    <script>
        (function () {
            const searchInput = document.getElementById('docSearch');
            const clearButton = document.getElementById('clearSearch');
            const resultCount = document.getElementById('resultCount');
            const noResults = document.getElementById('noResults');
            const methods = Array.from(document.querySelectorAll('.method'));
            const sections = Array.from(document.querySelectorAll('h2[id]'));

            const records = methods.map((method) => {
                let section = method.previousElementSibling;
                while (section && section.tagName !== 'H2') {
                    section = section.previousElementSibling;
                }
                return { method, section };
            });

            function updateCount(visibleMethods, totalMethods) {
                resultCount.textContent = `${visibleMethods} / ${totalMethods} methods`;
            }

            function applyFilter(rawQuery) {
                const query = rawQuery.trim().toLowerCase();
                const visibleSections = new Set();
                let visibleMethods = 0;

                records.forEach(({ method, section }) => {
                    const text = method.textContent.toLowerCase();
                    const sectionText = section ? section.textContent.toLowerCase() : '';
                    const isVisible = !query || text.includes(query) || sectionText.includes(query);

                    method.hidden = !isVisible;
                    if (isVisible) {
                        visibleMethods += 1;
                        if (section) visibleSections.add(section);
                    }
                });

                sections.forEach((section) => {
                    section.hidden = !visibleSections.has(section) && Boolean(query);
                });

                noResults.hidden = visibleMethods > 0 || query.length === 0;
                updateCount(visibleMethods, methods.length);
            }

            searchInput.addEventListener('input', (event) => {
                applyFilter(event.target.value);
            });

            clearButton.addEventListener('click', () => {
                searchInput.value = '';
                applyFilter('');
                searchInput.focus();
            });

            document.addEventListener('keydown', (event) => {
                if (event.key === '/' && document.activeElement !== searchInput) {
                    event.preventDefault();
                    searchInput.focus();
                }
            });

            updateCount(methods.length, methods.length);
        })();
    </script>
</body>

</html>
